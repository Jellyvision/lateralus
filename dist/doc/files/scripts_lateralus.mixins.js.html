<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>scripts/lateralus.mixins.js - Lateralus</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://cdn.jellyvision.com/wp-content/themes/jellyvision/img/header-logo.png" title="Lateralus"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.9.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Lateralus.html">Lateralus</a></li>
            
                <li><a href="../classes/Lateralus.Collection.html">Lateralus.Collection</a></li>
            
                <li><a href="../classes/Lateralus.Component.html">Lateralus.Component</a></li>
            
                <li><a href="../classes/Lateralus.Component.Model.html">Lateralus.Component.Model</a></li>
            
                <li><a href="../classes/Lateralus.Component.View.html">Lateralus.Component.View</a></li>
            
                <li><a href="../classes/Lateralus.mixins.html">Lateralus.mixins</a></li>
            
                <li><a href="../classes/Lateralus.Model.html">Lateralus.Model</a></li>
            
                <li><a href="../classes/Lateralus.Router.html">Lateralus.Router</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: scripts/lateralus.mixins.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define([

  &#x27;underscore&#x27;

], function (

  _

) {
  &#x27;use strict&#x27;;

  /**
   * These method are mixed into &#x60;{{#crossLink &quot;Lateralus&quot;}}{{/crossLink}}&#x60;,
   * &#x60;{{#crossLink &quot;Lateralus.Component&quot;}}{{/crossLink}}&#x60;, and &#x60;{{#crossLink
   * &quot;Lateralus.Component.View&quot;}}{{/crossLink}}&#x60;.
   * @class Lateralus.mixins
   * @requires http://backbonejs.org/#Events
   */
  var mixins = {};

  /**
   * Event namespace for &#x60;{{#crossLink
   * &quot;Lateralus.mixins/provide:property&quot;}}{{/crossLink}}&#x60; handlers.
   * @type {string}
   * @property PROVIDE_PREFIX
   * @final
   * @private
   */
  mixins.PROVIDE_PREFIX = &#x27;_provide:&#x27;;
  var PROVIDE_PREFIX = mixins.PROVIDE_PREFIX;

  /**
   * @param {Object} obj
   * @return {boolean}
   */
  function isLateralus (obj) {
    return obj.toString() === &#x27;lateralus&#x27;;
  }

  /**
   * Add a subcomponent to a &#x60;{{#crossLink &quot;Lateralus&quot;}}{{/crossLink}}&#x60; or
   * &#x60;{{#crossLink &quot;Lateralus.Component&quot;}}{{/crossLink}}&#x60; instance.
   *
   *     var App = Lateralus.beget(function () {
   *       Lateralus.apply(this, arguments);
   *     });
   *
   *     var app = new App(document.getElementById(&#x27;app&#x27;));
   *     var component = app.addComponent(Lateralus.Component);
   *     var subcomponent = component.addComponent(Lateralus.Component);
   * @method addComponent
   * @param {Lateralus.Component} Component A constructor, not an instance.
   * @param {Object} [viewOptions] The &#x60;options&#x60; object to be passed along to
   * the &#x60;Component&#x60; parameter&#x27;s {{#crossLink
   * &quot;Lateralus.Component.View&quot;}}{{/crossLink}} instance.
   * @param {Object} [options] Gets passed to the new {{#crossLink
   * &quot;Lateralus.Component&quot;}}{{/crossLink}} instance.
   * @param {Object} [options.modelAttributes] Any attributes to pre-populate
   * the &#x60;{{#crossLink &quot;Lateralus.Component/Model:property&quot;}}{{/crossLink}}&#x60;
   * instance with, if there is one.
   * @param {Object} [options.modelOptions] Any parameters to pass to the
   * &#x60;{{#crossLink &quot;Lateralus.Component/Model:property&quot;}}{{/crossLink}}&#x60;
   * instance, if there is one.
   * @return {Lateralus.Component} The component that was added.
   */
  mixins.addComponent = function (Component, viewOptions, options) {
    options = options || {};

    // If this object belongs to a Lateralus.Component (such as a
    // Lateralus.Component.View or Lateralus.Component.Model), add the new
    // subcomponent to that containing Lateralus.Component.
    if (typeof this.component !== &#x27;undefined&#x27;) {
      return this.component.addComponent.apply(this.component, arguments);
    }

    // If this object is a Lateralus.Model, add the new subcomponent to the
    // central Lateralus instance.
    if (this.toString() === &#x27;lateralus-model&#x27;) {
      return this.lateralus.addComponent.apply(this.lateralus, arguments);
    }

    if (!this.components) {
      /**
       * The subcomponents belonging to this object.  Do not modify this
       * property directly, it is managed by Lateralus.
       * @property components
       * @type {Object(Lateralus.Component)}
       */
      this.components = {};

      /**
       * An internal counter registry of the subcomponents belonging to this
       * object.
       * @property componentCounters
       * @type {Object(number)}
       * @private
       */
      this.componentCounters = {};
    }

    // If thisIsLateralus is false, &#x60;this&#x60; is a Lateralus.Component instance.
    var thisIsLateralus = isLateralus(this);

    var lateralusReference = thisIsLateralus ? this : this.lateralus;
    var component = new Component(
      lateralusReference
      ,options
      ,viewOptions || {}
      ,thisIsLateralus ? null : this
    );

    if (thisIsLateralus &amp;&amp; component.view) {
      this.$el.append(component.view.$el);
    }

    var componentType = component.toString();
    if (this.componentCounters.hasOwnProperty(componentType)) {
      this.componentCounters[componentType]++;
    } else {
      this.componentCounters[componentType] = 0;
    }

    var componentInstanceName =
        componentType + this.componentCounters[componentType];
    this.components[componentInstanceName] = component;

    return component;
  };

  /**
   * Components should never communicate directly with one another in order to
   * maintain a loosely-coupled architecture.  Instead, they should just
   * broadcast general messages with the [&#x60;Backbone.Events&#x60;
   * API](http://backbonejs.org/#Events).  &#x60;emit&#x60; facilitates this loose
   * coupling by firing an event that bubbles throughout the app, depending on
   * what calls it:
   *
   * * If this is called by &#x60;{{#crossLink &quot;Lateralus&quot;}}{{/crossLink}}&#x60;, this
   * just triggers an event on that &#x60;{{#crossLink &quot;Lateralus&quot;}}{{/crossLink}}&#x60;
   * instance.
   * * If this is called by a &#x60;{{#crossLink
   * &quot;Lateralus.Component&quot;}}{{/crossLink}}&#x60;, this triggers an event on that
   * &#x60;{{#crossLink &quot;Lateralus.Component&quot;}}{{/crossLink}}&#x60; as well as the
   * central &#x60;{{#crossLink &quot;Lateralus&quot;}}{{/crossLink}}&#x60; instance.
   * * If this is called by a &#x60;{{#crossLink
   * &quot;Lateralus.Component.View&quot;}}{{/crossLink}}&#x60;, this triggers an event on
   * that &#x60;{{#crossLink &quot;Lateralus.Component.View&quot;}}{{/crossLink}}&#x60;, the
   * &#x60;{{#crossLink &quot;Lateralus.Component&quot;}}{{/crossLink}}&#x60; to which it belongs,
   * and the central &#x60;{{#crossLink &quot;Lateralus&quot;}}{{/crossLink}}&#x60; instance.
   *
   * This method has the same method signature as
   * [&#x60;Backbone.Events.trigger&#x60;](http://backbonejs.org/#Events-trigger).
   * @method emit
   * @param {string} eventName The name of the event.
   * @param {...any} [args] Any arguments to pass along to the listeners.
   */
  mixins.emit = function () {
    var args = _.toArray(arguments);
    this.trigger.apply(this, args);

    if (isLateralus(this)) {
      return;
    }

    if (this.component) {
      this.component.trigger.apply(this.component, args);
    }

    this.lateralus.trigger.apply(this.lateralus, args);
  };

  /**
   * Listen to an event-emitting Object and amplify one of its events across
   * the {{#crossLink &quot;Lateralus&quot;}}{{/crossLink}} application.  Useful for
   * making plain Backbone Objects (i.e., non-Lateralus Objects) communicate
   * important information in a broader way.
   * @method amplify
   * @param {Backbone.Events} emitter The object that &#x60;trigger&#x60;s events that
   * should be amplified globally across the app.
   * @param {string} eventName The event to amplify globally across the app.
   */
  mixins.amplify = function (emitter, eventName) {
    this.listenTo(emitter, eventName, _.bind(this.emit, this, eventName));
  };

  /**
   * Listen for an event that is triggered on the central {{#crossLink
   * &quot;Lateralus&quot;}}{{/crossLink}} instance and bind a function handler.
   * @method listenFor
   * @param {string} event The name of the event to listen for.
   * @param {Function} callback The function handler to bind.
   */
  mixins.listenFor = function (event, callback) {
    var thisIsLateralus = isLateralus(this);
    if (thisIsLateralus) {
      this.on(event, callback);
    } else {
      this.listenTo(this.lateralus, event, callback);
    }
  };

  mixins.setupProviders = function () {
    _.each(this.provide, function (fn, key) {
      // The &#x60;provide&#x60; Object may have already been processed by setupProviders
      // from a previous class instantiation (it is a shared prototype Object)
      // so check for that and don&#x27;t namespace the keys again.
      if (key.match(PROVIDE_PREFIX)) {
        return;
      }

      this.provide[PROVIDE_PREFIX + key] = function (callback, args) {
        callback(fn.apply(this, args));
      };

      delete this.provide[key];
    }, this);
  };

  /**
   * Execute any &#x60;{{#crossLink
   * &quot;Lateralus.mixins/provide:property&quot;}}{{/crossLink}}&#x60; handlers that have
   * been set up in the app and return an array of the returned values.
   *
   * Values that are &#x60;undefined&#x60; are excluded from the returned Array.
   * @method collect
   * @param {string} key The name of the &#x60;{{#crossLink
   * &quot;Lateralus.mixins/provide:property&quot;}}{{/crossLink}}&#x60; methods to run.
   * @param {...any} [args] Any parameters to pass along to &#x60;{{#crossLink
   * &quot;Lateralus.mixins/provide:property&quot;}}{{/crossLink}}&#x60; methods.
   * @return {Array(any)}
   */
  mixins.collect = function (key) {
    var args = _.toArray(arguments).slice(1);
    var collectedValues = [];

    this.emit(PROVIDE_PREFIX + key,
        _.bind(collectedValues.push, collectedValues), args);

    return _.reject(collectedValues, function (collectedValue) {
      return collectedValue === undefined;
    });
  };

  /**
   * Execute any &#x60;{{#crossLink
   * &quot;Lateralus.mixins/provide:property&quot;}}{{/crossLink}}&#x60; handlers that have
   * been set up in the app and return the first value.
   * @method collectOne
   * @param {string} key The name of the &#x60;{{#crossLink
   * &quot;Lateralus.mixins/provide:property&quot;}}{{/crossLink}}&#x60; methods to run.
   * @param {...any} [args] Any parameters to pass along to &#x60;{{#crossLink
   * &quot;Lateralus.mixins/provide:property&quot;}}{{/crossLink}}&#x60; methods.
   * @return {any}
   */
  mixins.collectOne = function () {
    return this.collect.apply(this, arguments)[0];
  };

  var delegateEventSplitter = /^(\S+)\s*(.*)$/;

  /**
   * Bind &#x60;{{#crossLink
   * &quot;Lateralus.mixins/lateralusEvents:property&quot;}}{{/crossLink}}&#x60;, if it is
   * defined.
   * @method delegateLateralusEvents
   * @chainable
   */
  mixins.delegateLateralusEvents = function () {
    this.setupProviders();

    _.each({
        /**
         * A map of functions or string references to functions that will
         * handle [events](http://backbonejs.org/#Events) dispatched to the
         * central &#x60;{{#crossLink &quot;Lateralus&quot;}}{{/crossLink}}&#x60; instance.
         *
         *     var ExtendedComponent = Lateralus.Component.extend({
         *       name: &#x27;extended&#x27;
         *
         *       ,lateralusEvents: {
         *         anotherComponentChanged: &#x27;onAnotherComponentChanged&#x27;
         *
         *         ,anotherComponentDestroyed: function () {
         *           // ...
         *         }
         *       }
         *
         *       ,onAnotherComponentChanged: function () {
         *         // ...
         *       }
         *     });
         * @property lateralusEvents
         * @type {Object|undefined}
         * @default undefined
         */
        lateralusEvents: this.lateralus || this

        /**
         * A map of functions that will handle &#x60;{{#crossLink
         * &quot;Lateralus.mixins/collect&quot;}}{{/crossLink}}&#x60; calls.  Each of the
         * functions attached to this Object should return a value.  These
         * functions **must** be completely synchronous.
         *
         *     var App = Lateralus.beget(function () {
         *       Lateralus.apply(this, arguments);
         *     });
         *
         *     _.extend(App.prototype, {
         *       provide: {
         *         demoData: function () {
         *           return 1;
         *         }
         *       }
         *     });
         *
         *     var app = new App();
         *     var ComponentSubclass = Lateralus.Component.extend({
         *       name: &#x27;provider&#x27;
         *       ,provide: {
         *         demoData: function () {
         *           return 2;
         *         }
         *       }
         *     });
         *
         *     app.addComponent(ComponentSubclass);
         *     console.log(app.collect(&#x27;demoData&#x27;)); // [1, 2]
         * @property provide
         * @type {Object|undefined}
         */
        ,provide: this.lateralus || this

        /**
         * A map of functions or string references to functions that will
         * handle [events](http://backbonejs.org/#Events) emitted by
         * &#x60;this.model&#x60;.
         *
         *     var ExtendedComponent = Lateralus.View.extend({
         *       modelEvents: {
         *         changed:someProperty: function (model, someProperty) {
         *           // ...
         *         }
         *       }
         *     });
         * @property modelEvents
         * @type {Object|undefined}
         * @default undefined
         */
        ,modelEvents: this.model
      }, function (subject, mapName) {

      if (!subject) {
        return;
      }

      var eventMap = this[mapName];

      if (eventMap) {
        // Inherit the parent object&#x27;s event map, if there is one.
        var childEventMap = eventMap;
        var ctorProto = this.constructor.prototype;

        if (ctorProto[mapName]) {
          // Temporarily delete the key so the next analogous key on the
          // prototype chain is accessible.
          delete ctorProto[mapName];

          // Grab the inherited map.
          var baseEventMap = this[mapName];

          // Augment the child&#x27;s map with the parent&#x27;s.
          ctorProto[mapName] = _.defaults(childEventMap, baseEventMap);
        }
      }

      for (var key in eventMap) {
        var method = eventMap[key];
        if (!_.isFunction(method)) {
          method = this[eventMap[key]];
        }

        if (!method) {
          new Error(&#x27;Method &quot;&#x27; + method + &#x27;&quot; not found for &#x27; + this.toString());
        }

        var match = key.match(delegateEventSplitter);
        var eventName = match[1];
        var boundMethod = _.bind(method, this);

        if (isLateralus(this) &amp;&amp; isLateralus(subject)) {
          this.on(eventName, boundMethod);
        } else {
          this.listenTo(subject, eventName, boundMethod);
        }
      }
    }, this);

    return this;
  };

  /**
   * Helper function for initModel and initCollection.
   * @param {Object} [initialObject]
   * @return {{ lateralus: Lateralus, component: Lateralus.Component= }}
   * component is not defined if &#x60;this&#x60; is the Lateralus instance.
   */
  function getAugmentedOptionsObject (initialObject) {
    // jshint validthis:true
    var thisIsLateralus = isLateralus(this);
    var augmentedOptions = _.extend(initialObject || {}, {
      lateralus: thisIsLateralus ? this : this.lateralus
    });

    if (!thisIsLateralus) {
      augmentedOptions.component = this.component || this;
    }

    return augmentedOptions;
  }

  /**
   * @param {Lateralus.Component.Model} Model A constructor, not an instance.
   * @param {Object} [attributes]
   * @param {Object} [options]
   * @return {Lateralus.Component.Model} An instance of the provided Model
   * constructor.
   * @method initModel
   */
  mixins.initModel = function (Model, attributes, options) {
    if (isLateralus(this)) {
      return new Model(this, attributes, options);
    }

    var augmentedOptions = getAugmentedOptionsObject.call(this, options);
    return new Model(attributes, augmentedOptions);
  };

  /**
   * @param {Lateralus.Component.Collection} Collection A constructor, not an
   * instance.
   * @param {Array.(Lateralus.Model)} [models]
   * @param {Object} [options]
   * @return {Lateralus.Component.Collection} Am instance of the provided
   * Collection constructor.
   * @method initCollection
   */
  mixins.initCollection = function (Collection, models, options) {
    var augmentedOptions = getAugmentedOptionsObject.call(this, options);
    return new Collection(models, augmentedOptions);
  };

  /**
   * Merge the properties of another object into this object.  If the &#x60;mixin&#x60;
   * configuration object has a method called &#x60;initialize&#x60;, it is called in the
   * context of the object calling this function.
   * @method mixin
   * @param {Object} mixin The object to mix in to this one.
   */
  mixins.mixin = function (mixin) {
    _.extend(this, _.omit(mixin, &#x27;initialize&#x27;));

    if (typeof mixin.initialize === &#x27;function&#x27;) {
      mixin.initialize.call(this);
    }
  };

  return mixins;
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
